# Looker Heat Pump Calculator

This repository contains the LookML code for a custom Heat Pump Calculator application built entirely within Looker. It serves as a practical example for customers demonstrating how to leverage Looker's modeling layer to create interactive, data-driven applications.

The application allows users to input various details about their home and receive an estimated cost and size for a new heat pump system. This provides a dynamic and engaging experience for users while showcasing the power of Looker beyond traditional business intelligence.

![Heat Pump Calculator App](image.png)

---

## How It Works

The calculator is built upon a single LookML `view` that cleverly uses parameters as user inputs. When a user changes a filter, like the "Year Built" or "Total Square Footage", the application dynamically recalculates the estimates in real-time.

The core logic is based on a **base cost** calculation which is then adjusted by a series of **multipliers**. Each multiplier corresponds to a user-selectable parameter, allowing for a nuanced and accurate final estimate.

---

## Key Components & Features

### 1. User Inputs (Parameters)

Instead of filtering existing data, we use LookML **`parameters`** to capture user input. These are defined as interactive filters on the dashboard.

*   Total Square Footage
*   Year Built
*   Number of Stories
*   Finished Basement (Yes/No)
*   Home Insulation (Yes/No)
*   Primary Heating Fuel
*   And several others...

**Example LookML for a parameter:**

```lookml
parameter: p_year_built {
  label: "Year Built"
  type: string
  allowed_value: { value: "2010+" }
  allowed_value: { value: "1990 to 2009" }
  allowed_value: { value: "1970 to 1889" }
  allowed_value: { value: "Before 1970" }
}

2. Calculation Logic (Multipliers)
The heart of the calculator is a series of hidden dimensions that apply a multiplier to a base cost. Each dimension uses a CASE statement to determine the correct multiplier based on the user's selection in the corresponding parameter.

Example of a multiplier dimension:

lookml
dimension: _year_built_multiplier {
  hidden: yes
  type: number
  sql:
    CASE
      WHEN {% parameter p_year_built %} = '2010+' THEN 0.9
      WHEN {% parameter p_year_built %} = '1990 to 2009' THEN 1.0
      WHEN {% parameter p_year_built %} = '1970 to 1889' THEN 1.1
      ELSE 1.25
    END ;;
}
The final estimates are measures that aggregate all these multipliers together.

lookml
measure: high_cost_estimate {
  label: "High Cost"
  type: number
  sql:
    (
      ${_base_cost_calc}
      * ${_system_type_multiplier}
      * ${_fuel_type_multiplier}
      * ${_year_built_multiplier}
      * ${_insulation_multiplier}
      * ...
    ) * 1.25
    ;;
  value_format_name: usd_0
}
3. Dynamic Data from a Database Table
To make the calculator more scalable and easier to maintain, some multipliers (like state-specific pricing) are not hardcoded in LookML. Instead, they are sourced from a separate database table.

The system_state view connects to this table, and a join in the explore makes this data available to the calculator. This is a powerful technique for managing complex business logic outside of the LookML code itself.

The explore joining the views:

lookml
explore: heat_pump_calculator {
  join: system_state {
    type: left_outer
    relationship: one_to_many
    sql_on: 1=1 ;;
  }
}
4. Dynamic Images
The application displays a different image based on the "System Type" selected by the user. This is achieved using Liquid templating within the html parameter of a dimension.

lookml
dimension: image {
  type: string
  sql: ' ' ;;
  html:
  {% if p_system_type._parameter_value == "'Ducted'" %}
    <img src="..." height="230" width="330">
  {% elsif p_system_type._parameter_value == "'Mixed'" %}
    <img src="..." height="170" width="200">
  {% endif %} ;;
}
5. Custom Actions
The "Request an Estimate" button is a Looker Action. This feature allows you to send the data generated by Looker (in this case, the cost and tons estimates) to an external application, such as a CRM or a custom webhook, to trigger a workflow.

How to Replicate This Project
You can use this repository as a reference to build your own calculator. Here are the high-level steps:

Create the Data Table:
In your database (e.g., BigQuery), create a table to hold any multipliers you don't want to hardcode. For this project, we used a table named system_state with the following structure:

State	Primary System Type	State Multiplier	System Type Multiplier
Alabama	Furnace	0.95	1.0
California	Heat Pump	1.15	1.05
...	...	...	...
Add the LookML Files:

Add the heat_pump_calculator.view.lkml file to your LookML project.

Create a new view file for your database table (system_state.view.lkml) and update the sql_table_name to point to the table you created in Step 1.

Add the explore definition to your model file to join the two views.

Build the Dashboard:

Create a new dashboard in Looker.

Add the parameters from your heat_pump_calculator explore as filters on the dashboard.

Add the measures (low_cost_estimate, high_cost_estimate, etc.) and the image dimension as visualizations.

Arrange, resize, and configure the dashboard elements to match the look and feel of the application. The final result is a fully interactive application for your users.
